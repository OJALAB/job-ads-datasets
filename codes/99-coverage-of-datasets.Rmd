---
title: "R Notebook"
output: html_notebook
---

```{r}
library(data.table)
```

datasets

```{r}
hierachy <- fread("../data/kzis-hierarchy-2023.tsv", colClasses = "character", sep = "\t")
official <- fread("../data/kzis-occup-dictionary-long-2024.csv", colClasses = "character")
esco <- fread("../data/esco-kzis-selected.csv", colClasses = "character")
thes <- fread("../data/gus-thesaurus.csv", colClasses = "character")

info <- fread("../data/kzis-occup-infodoradca-2024-updated.csv", colClasses = "character")
kprm <- fread("../data/kprm-selected.csv", colClasses = "character")
hand <- fread("../data/hand-coded.csv", colClasses = "character")
cbop <- fread("../data-raw/cbop-codes-2024.csv", colClasses = "character")

hierachy[, dict := class %in% unique(official$code)]
hierachy[, esco := class %in% unique(esco$code)] ## 557 codes
hierachy[, thes := class %in% unique(thes$code)] ## 1338 codes
hierachy[, info := class %in% unique(info$class)] ## 1000 codes
hierachy[, kprm := class %in% unique(kprm$code)] ## 12 codes
hierachy[, hand := class %in% unique(hand$code)] ## 1044 codes
hierachy[, cbop:= class %in%  cbop$code] # 2295 codes / 1952

hierachy[, all := (esco + thes + info + kprm + hand + cbop) > 0]
hierachy[nchar(class) == 6, lapply(.SD, function(x) round(mean(x)*100,2)), .SDcols = dict:all]
```

By 1 digit

```{r}
hierachy[nchar(class) == 6, 
         lapply(.SD, function(x) round(mean(x)*100,2)), 
         keyby=.(digit1=substr(class,1,1)),
         .SDcols = dict:all]
```

Which are not covered

```{r}
hierachy[all == FALSE, .(code, name)][order(code)]
hierachy[, count:=esco+thes+info+kprm]
all_data_wide[count == 1]
```

