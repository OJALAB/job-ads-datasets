---
title: "R Notebook"
output: html_notebook
---

```{r}
library(data.table)
library(sampling)
library(stringr)
```

Official hierarchy

```{r}
hierachy <- fread("../data/kzis-hierarchy-2023.tsv", colClasses = "character", sep = "\t")
```

For training only

```{r}
official <- fread("../data/kzis-occup-dictionary-long-2024.csv", colClasses = "character")
official[nchar(code) == 5, code:=paste0("0", code)]
thes <- fread("../data/gus-thesaurus.csv", colClasses = "character")
```

For testing only

```{r}
hand_1k <- fread("../data/hand-coded-1k.csv", colClasses = "character")
```

For both

```{r}
info <- fread("../data/kzis-occup-infodoradca.csv", colClasses = "character")
kprm <- fread("../data/kprm-selected.csv", colClasses = "character")
hand <- fread("../data/hand-coded.csv", colClasses = "character")
esco <- fread("../data/esco-kzis-selected.csv", colClasses = "character")
cbop <- fread("../data/cbop-for-train-test.tar.gz", colClasses = "character")
```


```{r}
set.seed(123)

all_sources <- rbind(info[, source:="info"], kprm[, source:="kprm"], hand[, source:="hand"], 
                     esco[, source:="esco"][, .(code, desc, source)], cbop[, source:="cbop"])

all_sources[, size := .N, code]
all_sources[, size_test := round(size*0.7), code]
all_sources[, id:=1:.N]

train_data <- all_sources[, .SD[sample(.N, size_test[1])], code]
test_data <- all_sources[!id %in% train_data$id]

test_data <- rbind(test_data, all_sources[size == 1])

train_data <- rbind(train_data, official[, source:="official"], thes[, source:="gus"], fill = T)
test_data <- rbind(test_data, hand_1k[, source:="hand1k"], fill = T)

```

```{r}
fwrite(x = test_data[, .(class=code, desc=desc, source)], file = "../data/train-test/test-data-2024.tar.gz")
fwrite(x = train_data[, .(class=code, desc=desc, source)], file = "../data/train-test/train-data-2024.tar.gz")
```

